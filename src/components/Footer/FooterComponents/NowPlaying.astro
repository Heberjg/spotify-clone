---
// components/NowPlaying.astro
import { Image } from 'astro:assets';
import placeholderImage from "../../../assets/background.svg";

// truco para que funcione el image de una vez por todas
const imageSrc =  placeholderImage;
---
  <!-- Contenedor para la canci贸n -->
  <div id="current-song-display">
    <Image
      src={imageSrc}
      alt={"Portada de canci贸n"}
      width={50}
      height={50}
      formats={['webp']}
      quality={80}
      loading="eager"
      id="song-image"
    />
    <div class="song-info">
      <h3 id="song-title" class="song-title">
      </h3>
      <p id="song-artist" class="song-artist">
      </p>
    </div>
  </div>
  

  <script >
    import { playerStore } from "../../../store/playerStore.mjs";
    // Suscripci贸n a cambios en el store
    const unsubscribe = playerStore.subscribe((state) => {
      const { currentSongData } = state;
      const songImage = document.getElementById('song-image') as HTMLImageElement;
      const songTitle = document.getElementById('song-title');
      const songArtist = document.getElementById('song-artist');
      // const currentDisplay = document.getElementById('current-song-display');
      // const noSongMessage = document.getElementById('no-song-message');

      if (currentSongData) {
        // Actualizar elementos con los datos de la canci贸n
        songImage.src = currentSongData.image.src || '';
        songImage.alt = `Portada de ${currentSongData.name}`;
        songTitle.textContent = currentSongData.name;
        songArtist.textContent = currentSongData.artist;
      } 
    });

    // Limpieza al desmontar
    window.addEventListener('beforeunload', unsubscribe);
  </script>

<style>
  .now-playing-container {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  #current-song-display {
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  
  .song-image {
    border-radius: 4px;
    object-fit: cover;
  }
  
  .song-info {
    display: flex;
    flex-direction: column;
  }
  
  .song-title {
    margin: 0;
    font-size: 1rem;
    font-weight: 500;
  }
  
  .song-artist {
    margin: 0;
    font-size: 0.875rem;
    color: #666;
  }
  
  #no-song-message {
    margin: 0;
    color: #666;
    font-style: italic;
  }
</style>