---
// components/NowPlaying.astro
import { Image } from 'astro:assets';
import placeholderImage from "../../../assets/background.svg";

// truco para que funcione el image de una vez por todas
const imageSrc =  placeholderImage;
---
  <!-- Contenedor para la canci贸n -->
  <div id="current-song-display">
    <img
      src={imageSrc.src}
      alt={"Portada de canci贸n"}
      width={50}  
      height={50}
      
      id="song-image"
    />
    <div class="song-info">
      <h3 id="song-title">
      </h3>
      <p id="song-artist">
      </p>
    </div>
  </div>
  

  <script >
    import { playerStore } from "../../../store/playerStore.mjs";
    // Suscripci贸n a cambios en el store
    let currentImageUrl = '';
    const unsubscribe = playerStore.subscribe((state) => {
      const { currentSongData } = state;
      const songImage = document.getElementById('song-image') as HTMLImageElement;
      const songTitle = document.getElementById('song-title');
      const songArtist = document.getElementById('song-artist');
      // const currentDisplay = document.getElementById('current-song-display');
      // const noSongMessage = document.getElementById('no-song-message');

      if (currentSongData) {
        // Actualizar elementos con los datos de la canci贸n
        const newImageUrl = currentSongData.image?.src || '';
      if (newImageUrl && newImageUrl !== currentImageUrl) { 
        currentImageUrl = newImageUrl;
        songImage.src = currentSongData.image.src || '';
      songImage.alt = `Portada de ${currentSongData.name}`;
    }
        songTitle.textContent = currentSongData.name;
        songArtist.textContent = currentSongData.artist;
      } 
    });

    // Limpieza al desmontar
    window.addEventListener('beforeunload', unsubscribe);
  </script>


<style>
  
  #current-song-display {
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  
  #song-image {
    border-radius: 4px;
    width: 55px;
    height: auto;
  }
  
  .song-info {
    display: flex;
    flex-direction: column;
  }
  
  #song-title {
    margin: 0;
    font-size: 1rem;
    font-weight: 500;
    text-wrap: nowrap;
    overflow: hidden;
  }
  
  #song-artist {
    margin: 0;
    font-size: 0.875rem;
    color: #888;
    overflow: hidden;
    text-wrap: nowrap
  }
  
  
</style>